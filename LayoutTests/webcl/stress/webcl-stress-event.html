<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>WebCLEvent stress test </title>
<script src="../resources/js-test-pre.js"></script>
<script src="../resources/webcl-test.js"></script>

<script>

var STRESS_ITERS = 100000;

var callback = function () {
        console.log("Event callback!");
    };

function runTest() {

    try {
        var webclTest = WebCLTest;
        webclTest.init(0, 0, "gpu");

        var cl = webclTest.getCL();
        var platform = webclTest.getPlatform(0);
        var devices = webclTest.getDevices();

        var properties = { platform: platform, devices: devices,
                            deviceType: cl.DEVICE_TYPE_GPU};
        var context = webclTest.createContext(properties);

        var clEvent = null;
        var events = [];
        var i;

        for (i = 0; i < STRESS_ITERS; ++i) {
            clEvent = webclTest.createEvent(callback, cl.STOPPED);
            if (clEvent === null || !(clEvent instanceof WebCLEvent)) {
                testFailed("WebCLEvent was not created properly ...");
                return;
            }
            events.push(clEvent);
            clEvent = null;
        }
        testPassed("WebCLEvent creation");

        clEvent = null;
        for (i = 0; i < STRESS_ITERS; ++i) {
            clEvent = events.pop();
            clEvent.release();
            clEvent = null;
        }

        testPassed(" ");

    } catch (e) {
        testFailed("WebCLEvent stress test failed ; Message: " + e.message);
    }
}

</script>
</head>
<body>
<div id="description"></div>
<div id="console"></div>
<script>
    description("WebCLEvent stress test.");
    runTest();
</script>
<script src="../resources/js-test-post.js"></script>
</body>
</html>
